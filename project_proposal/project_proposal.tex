\documentclass[12pt,letterpaper]{article}

\title{
\textbf{\LARGE OBD Bluetooth Interface and Android App} \\
\Large Project Proposal Document
}

\author{
\normalsize Patrick Landis (pal25) \\
\normalsize Schuyler Thompson (sdt16) (Current Team Lead) \\
\normalsize Advisor: Swarup Bhunia, PhD
}
	
\date{\normalsize January 28, 2013}
\usepackage[margin=1in]{geometry}
\usepackage{graphicx}
\usepackage{epstopdf}
\usepackage{pgfgantt}
\usepackage{indentfirst}

\begin{document}
\maketitle

\newpage

\section{Technical}
\subsection{Problem Description}
Every car in the United States since 1996 is required, by law, to contain on-board diagnostics. This standard, codified in SAE J1939 as on-board diagnostics II (OBD-II). The OBD-II specification officially requires a few different things. The OBD-II specification requires that all cars make available data link connector and also place restrictions on where they can be placed. The specification defines a set of standard diagnostic trouble codes, the freeze frame (which is sort of like a black box), and requirements for MIL lighting (which deals with the check engine light). In addition it also defines specific terminology for emissions controls components, defines diagnostic trouble codes. A device is then plugged into the data link port to read messages over various protocols implemented by the car manufacturer. \\*

Currently, technicians must manually plug in a device into this port in order to read OBD-II messages. Furthermore the current solutions only have basic functionality and are primarily for technicians. Our project aims to add wireless functionality for OBD-II via Bluetooth to be interfaced with Android compatible devices. Furthermore this project aims to make communication cryptographically secure. By allowing for cryptographically secure wireless OBD-II messages to be transferred to fairly ubiquitous Android-enabled devices this project is geared to enthusiasts and curious electronic hackers.


\subsection{Project Specifications}
This project has quite a few objectives because there are quite a few parts to it. This section will refer to Appendix I, a diagram which shows the information exchange, to clarify things.

\subsubsection{OBD-II Interface Component}
\begin{itemize}
	\item This component requires a circuit which will have the functionality to interface directly to a car's OBD-II port. 
	\item This component is required to plug into the data link connector specified in the OBD-II specification SAE J1962
	\item This component will need to be able to act as a transceiver with the OBD-II port.
	\item The component will also be responsible for encoding and decoding messages for each of the protocols allowed in the OBD-II standard which are:
	\begin{enumerate}
		\item SAE J/1850 (PWM/VPW)
		\item ISO 15765-2 / SAE J2284 (CAN)
		\item SAE J2411 (Single Wire CAN)
		\item ISO 9141-2/14230-4 (Keyword Protocol)
		\item Ford DCL (Mostly Depreciated) 
	\end{enumerate}
	\item This component will be required to communicate with the central microcontroller in via UART.
	\item This component will be powered from the OBD-II port.
	\item This component will be responsible for buffering messages until they can be sent to the MCU.
\end{itemize}

\subsubsection{Bluetooth Interface Component}
\begin{itemize}
	\item This component will be required to adhere to the Bluetooth 2.1+ specification.
	\item This component will be required to communicate with the central microcontroller in via UART.
	\item This board will be responsible for communicating via Bluetooth to Android enabled devices.
	\item This component will be powered from the OBD-II port.
	\item This component will be responsible for setting up Bluetooth communications with Android enabled devices.
	\item This component will be responsible for negotiating the shared key for cryptography purposes.
\end{itemize}

\subsubsection{Central Microcontroller}
\begin{itemize}
	\item This MCU must be able to communicate with the OBD-II interface component via UART.
	\item This MCU must be able to communicate with the Bluetooth interface component via UART.
	\item This component will be powered from the OBD-II port.
	\item MCU will be used to control message flow of the system.
	\item The MCU with be required to store a list of recent pairing keys to allow Android devices to auto-connect.
\end{itemize} 

\subsubsection{Bluetooth Functionality Android-side}
\begin{itemize}
	\item There will be writing an Android app to receive data from the OBD reader.
	\item It will use the Android SDK to implement the bluetooth functionality.
	\item The app will be able to display all of the basic messages from the diagnostic part of OBD.
	\item This includes the fault codes, monitor readiness, and whether the malfunction indicator light (MIL) is on or off.
	\item The OBD fault codes follow a pattern of N0000, a letter followed by 4 numbers. The app will contain the database of all of the standard codes and their meanings for easy lookup. 
	\item  The monitor readiness is indicating whether the all of the monitors used by the OBD system are ready to make a reading. They are reset when the OBD system is reset, and if the monitors are set to not ready, the car will fail any emissions check performed by a DMV. 
	\item The MIL is the light commonly known as the check engine light. 
	\item The app will use the Android Holo theme, and will follow the generally accepted design principals of Android UI design.
	\item The app will pair with one dongle at a time.
	\item The app will work with Android 4.1.

\end{itemize}

\subsubsection{Cryptographically Securing Messages}
This section doesn't describe any specific component of the system. This section describes functional requirements for the overall system to cryptographically secure wireless messages. The basis of this approach is to use Bluetooth's Secure Simple Pairing for security. This pairing protocol is mandatory for all BT 2.1+ devices.

\begin{itemize}
	\item Will use ``Just Works" form of pairing.
	\item The pairing key will be stored on the non-Android side of communication in the MCU.
	\item Both devices must acknowledge the pairing request.
\end{itemize}

\subsection{Project Work Strategy}


\subsection{Strategy for Achieving Objectives}

\subsection{Verification and/or Testing}
\subsubsection{OBD-II Interface Component}
Because OBD-II simulators are expensive a live car will need to be used for the functional testing of signals pertaining to the OBD-II port. Below is a list of tests that will need to be completed to verify that the OBD-II interface board is properly working.

\begin{itemize}
\item Any regulator circuits will be bench-tested. The OBD-II port supplies power from a car's battery and is usually fuse-protected with the cigarette lighter (usually 10-15A fuse). The regulators will be tested to make sure the regulators are properly supplying power at 5V and/or 3.3V from 12V bench supply.
\item To ensure that signals are being properly parsed, any messages received will be measured against a known functional ``scanner tool" used by technicians.
\item This interface component will be tested on different vehicle brands to test the different communication protocols.
\end{itemize}

\subsubsection{Bluetooth Interface Component}
\begin{itemize}
\item The bluetooth module is controlled though the microcontroller, so the testing will be done with that.
\item If there is an electrical problem, the specification sheet contains all of the information needed to troubleshoot.
\end{itemize}

\subsubsection{Central Microcontroller}
\begin{itemize}
\item The code will be unit tested for all functionality.
\item There will be a test program for sending basic bluetooth commands. This will allow easy determination if a problem is bluetooth related or higher level than that.
\end{itemize}

\subsubsection{Bluetooth Functionality Android-side}
\begin{itemize}
\item The code will be unit tested before it goes on the device to verify basic functionality.
\item The Android emulator included in the Android SDK will be used to test the user interface as the software is being developed. 
\item An Android VM (separate from the emulator) will be used to test the bluetooth functionality. The VM is harder to work with, but the emulator does not support testing bluetooth. 
\item There will be a separate test within the app to test the bluetooth application level protocol. This will be useful for debugging, in order to quickly verify if issues are protocol related or another issue. 
\end{itemize}

\subsubsection{Cryptographically Securing Messages}
\begin{itemize}
\item This is a feature of the bluetooth standard, so if the devices pair, the Android phone will indicate if the communication is secure. 
\item A second phone will be used to verify that another phone cannot be paired without the permission of the permission of the board bluetooth module.
\end{itemize}

\section{Management}
\subsection{Team Complement}
\begin{itemize}
	\item Patrick Landis (pal25): Hardware development/verification and microcontroller programming

	\item Schuyler Thompson (sdt16): Software development/verification and microcontroller programming
\end{itemize}

\subsection{Project Management Plan}
\input{gantt_chart.tex}


\subsection{Budget}
\begin{tabular}{| l | p{7cm} | r |}
\hline
Item & Description & Price (\$ USD) \\ \hline
STN1110 & OBD-II Interface core & 0.00 (Free samples) \\ \hline
Microchip RN-41 & Bluetooth stack implementation on IC & 19.90 \\ \hline
Atmel ATMEGA328 & Not sure exactly which AVR core & 0.00 (Free samples) \\ \hline
Scanner Tool & To test/validate OBD messages & 15.00 \\ \hline
PCB Fabrication & If needed, paid by circuits lab & 0.00 \\ \hline
Misc. Components & If needed, paid by circuits lab & 0.00 \\ \hline
\hline
Total && 19.90 \\ \hline
\end{tabular}

\newpage

\section{Appendicies}
\subsection{Appendix I}
\begin{figure}[!ht]
\centering
\includegraphics[totalheight=15cm]{images/info_exchange_diagram.eps}
\caption{Information Flow Diagram}
\label{fig: image}
\end{figure}

\end{document}





